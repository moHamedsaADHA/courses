import http from 'http';

/**
 * ุชุญุณูู ุงุฎุชุจุงุฑ ุงูุชุณุฌูู ูุฅุฑุณุงู OTP ุจุงูุจุฑูุฏ ุงูุฅููุชุฑููู
 * ูุน ุชุญุณููุงุช ูุนุฑุถ ุฑุณุงุฆู ุงูุฎุทุฃ ูุชุชุจุน ุงูุนูููุงุช
 */

// ุจูุงูุงุช ุงููุณุชุฎุฏู ููุชุณุฌูู - ูู ุจุชุบููุฑ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ุฅูู ุจุฑูุฏู ุงูุญูููู
const postData = JSON.stringify({
  name: 'ุฃุญูุฏ ูุญูุฏ ุนูู ุญุณู',
  email: 'YOUR_REAL_EMAIL@example.com', // ูู ุจุชุบููุฑู ุฅูู ุจุฑูุฏู ุงูุฅููุชุฑููู ุงูุญูููู
  password: 'Password123',
  location: 'ุจุบุฏุงุฏ',
  grade: 'ุงูุตู ุงูุฃูู ุงูุฅุนุฏุงุฏู'
});

// ุฅุนุฏุงุฏ ุทูุจ HTTP
const options = {
  hostname: 'localhost',
  port: 3000,
  path: '/api/users/',
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'Content-Length': Buffer.byteLength(postData)
  }
};

console.log('=== ุงุฎุชุจุงุฑ ุชุณุฌูู ุงููุณุชุฎุฏู ูุฅุฑุณุงู ุจุฑูุฏ OTP ===');
console.log('\nุฅุฑุณุงู ุทูุจ ุงูุชุณุฌูู...');
console.log('ุงูุจูุงูุงุช:', JSON.parse(postData));

// ุชูููุฐ ุงูุทูุจ
const req = http.request(options, (res) => {
  console.log(`\nุงุณุชุฌุงุจุฉ ุงูุฎุงุฏู - ุฑูุฒ ุงูุญุงูุฉ: ${res.statusCode}`);
  console.log('ุนูุงููู ุงูุงุณุชุฌุงุจุฉ:', JSON.stringify(res.headers, null, 2));
  
  let data = '';
  res.on('data', (chunk) => {
    data += chunk;
  });
  
  res.on('end', () => {
    try {
      const parsed = JSON.parse(data);
      
      console.log('\n=== ูุชูุฌุฉ ุงูุงุฎุชุจุงุฑ ===');
      if (parsed.success || res.statusCode === 201) {
        console.log('โ ุชู ุงูุชุณุฌูู ุจูุฌุงุญ!');
        
        // ุงูุชุญูู ูู ุญุงูุฉ ุฅุฑุณุงู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู
        if (parsed.emailSent) {
          console.log('๐ง ุชู ุฅุฑุณุงู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ุจูุฌุงุญ.');
          console.log('๐ ุชุญูู ูู ุตูุฏูู ุงูุจุฑูุฏ ุงููุงุฑุฏ ุงูุฎุงุต ุจู (ูุฃูุถูุง ูุฌูุฏ ุงูุฑุณุงุฆู ุบูุฑ ุงููุฑุบูุจ ูููุง).');
          console.log('โฑ๏ธ ูุฏ ูุณุชุบุฑู ูุตูู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ุจุถุน ุฏูุงุฆู.');
        } else {
          console.log('โ ูุดู ุฅุฑุณุงู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู.');
          console.log('๐ ุงูุชุญูู ูู ูููุงุช ุงูุณุฌู ูู ุงูุฎุงุฏู ููุญุตูู ุนูู ูุฒูุฏ ูู ุงูุชูุงุตูู.');
          
          if (parsed.otpForTesting) {
            console.log('๐ข ุฑูุฒ OTP ููุงุฎุชุจุงุฑ (ูุชุงุญ ููุท ุจุณุจุจ ูุดู ุฅุฑุณุงู ุงูุจุฑูุฏ):', parsed.otpForTesting);
          }
        }
        
        // ุนุฑุถ ุงูุฑูุฒ ุงููุคูุช ุฅุฐุง ูุงู ูุชุงุญูุง
        if (parsed.tempToken) {
          console.log('\n๐ ุงูุฑูุฒ ุงููุคูุช ูุชุงุญ ููุชูุนูู (ุตุงูุญ ููุฏุฉ ุณุงุนุฉ ูุงุญุฏุฉ)');
        }
      } else {
        console.log('โ ูุดู ุงูุชุณุฌูู!');
        console.log('ุฑุณุงูุฉ ุงูุฎุทุฃ:', parsed.message || 'ูุง ุชูุฌุฏ ุฑุณุงูุฉ ุฎุทุฃ');
        if (parsed.error) {
          console.log('ุชูุงุตูู ุงูุฎุทุฃ:', parsed.error);
        }
      }
      
      // ุนุฑุถ ุงูุงุณุชุฌุงุจุฉ ุงููุงููุฉ ููุชุญููู
      console.log('\n=== ุงูุงุณุชุฌุงุจุฉ ุงููุงููุฉ ===');
      console.log(JSON.stringify(parsed, null, 2));
      
    } catch (e) {
      console.log('\nโ ุฎุทุฃ ูู ุชุญููู ุงุณุชุฌุงุจุฉ JSON:');
      console.log('ุงุณุชุฌุงุจุฉ ุบูุฑ ุตุงูุญุฉ:', data);
      console.log('ุฎุทุฃ ุงูุชุญููู:', e.message);
    }
    
    console.log('\n=== ุงูุชูุงู ุงูุงุฎุชุจุงุฑ ===');
    console.log('ููุชุญูู ูู ุฅุนุฏุงุฏุงุช Brevo ูุงูุจุฑูุฏ ุงูุฅููุชุฑูููุ ุฑุงุฌุน ููู BREVO-EMAIL-SETUP-GUIDE.md');
  });
});

// ูุนุงูุฌุฉ ุฃุฎุทุงุก ุงูุทูุจ
req.on('error', (e) => {
  console.error('\nโ ุฎุทุฃ ูู ุทูุจ HTTP:');
  console.error('- ุงูุฑุณุงูุฉ:', e.message);
  console.error('- ุงูุฑูุฒ:', e.code);
  console.error('- ุงูุชูุงุตูู:', e);
  console.error('\n๐ ุชุฃูุฏ ูู ุชุดุบูู ุงูุฎุงุฏู ุนูู ุงููููุฐ 3000');
});

// ุฅุฑุณุงู ุงูุจูุงูุงุช ูุฅููุงุก ุงูุทูุจ
req.write(postData);
req.end();