# ๐ ูุดุฑ ุงููุดุฑูุน ุนูู Vercel - ุฎุทูุงุช ูููุฉ

## ุงููุดุงูู ุงูุชู ุชู ุญููุง:

### 1. โ๏ธ ุฎุทุฃ `Operation buffering timed out`
- **ุงูุณุจุจ:** ุนุฏู ุงุชุตุงู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุจุดูู ุตุญูุญ ูู ุจูุฆุฉ serverless
- **ุงูุญู:** ุชุญุณูู ุฅุนุฏุงุฏุงุช ุงูุงุชุตุงู ูุฅุถุงูุฉ timeout ููุงุณุจ

### 2. ๐ง ุงูุชุญุณููุงุช ุงููุทุจูุฉ:

#### ุฃ) ููู `src/config/db.js`:
- ุฅุถุงูุฉ ูุธุงู ุชุชุจุน ุงูุงุชุตุงู ูุชุฌูุจ ุฅุนุงุฏุฉ ุงูุงุชุตุงู ุงููุชูุฑุฑุฉ
- ุฅุนุฏุงุฏุงุช ุงุชุตุงู ูุญุณูุฉ ูู Vercel:
  - `serverSelectionTimeoutMS: 10000` (10 ุซูุงูู)
  - `socketTimeoutMS: 45000` (45 ุซุงููุฉ)
  - `maxPoolSize: 10` (ุนุฏุฏ ุงูุงุชุตุงูุงุช ุงููุชุฒุงููุฉ)
  - ุฅุฒุงูุฉ ุงูุฎูุงุฑุงุช ุงููุฏููุฉ ุงูููููุฉ

#### ุจ) ููู `api/index.js`:
- ุงูุชุฃูุฏ ูู ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช ูุจู ูุนุงูุฌุฉ ุงูุทูุจุงุช
- ูุนุงูุฌุฉ ุฃูุถู ููุฃุฎุทุงุก

#### ุฌ) ููู `get-all-courses.handler.js`:
- ุฅุถุงูุฉ ูุนุงูุฌุฉ ุฃุฎุทุงุก ุดุงููุฉ
- ุฅุถุงูุฉ `maxTimeMS(5000)` ููุญุฏ ูู ููุช ุงูุงุณุชุนูุงู
- ุงุณุชุฎุฏุงู `.lean()` ูุชุญุณูู ุงูุฃุฏุงุก
- ุงูุชุญูู ูู ุญุงูุฉ ุงูุงุชุตุงู ูุจู ุงูุงุณุชุนูุงู

#### ุฏ) ููู `vercel.json`:
- ุฅุถุงูุฉ ุฅุนุฏุงุฏุงุช build ูุญุณูุฉ
- ุฒูุงุฏุฉ ุงูุฐุงูุฑุฉ ุงููุฎุตุตุฉ ุฅูู 1024 MB
- ุชุญุฏูุฏ `maxDuration: 30` ุซุงููุฉ

## ๐ ุฎุทูุงุช ุงููุดุฑ ุนูู Vercel:

### 1. ุชุญุฏูุซ ูุชุบูุฑุงุช ุงูุจูุฆุฉ ูู Vercel:

ุงูุชูู ุฅูู: **Project Settings** โ **Environment Variables**

ุฃุถู ุงููุชุบูุฑุงุช ุงูุชุงููุฉ:

```
DB_URL=mongodb+srv://mohamedahmed342005_db_user:fnT4gxiObL6lgYVe@cluster0.ughy3xc.mongodb.net/?retryWrites=true&w=majority&appName=Cluster0

JWT_SECRET=supersecret
JWT_REFRESH_SECRET=refresh_super_secret_key_2024
JWT_EXPIRES_IN=30d

CORS_ORIGIN=https://mohamedsaadha.github.io/courses_f

NODE_ENV=production
```

### 2. ุงูุชุฃูุฏ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช MongoDB:

- โ ุชุญุฏูุซ Network Access ูู MongoDB Atlas ูุฅุถุงูุฉ IP: `0.0.0.0/0` (ููุณูุงุญ ุจุงููุตูู ูู Vercel)
- โ ุงูุชุฃูุฏ ูู ุตุญุฉ ูุนูููุงุช ุงูุงุชุตุงู (username, password, cluster name)

### 3. ุฅุนุงุฏุฉ ุงููุดุฑ:

```bash
# ุฅุฐุง ููุช ุชุณุชุฎุฏู Vercel CLI
vercel --prod

# ุฃู ูู ุฎูุงู Git
git add .
git commit -m "Fix MongoDB connection for Vercel"
git push origin main
```

### 4. ูุฑุงูุจุฉ ุงูุณุฌูุงุช (Logs):

ุจุนุฏ ุงููุดุฑุ ุชุงุจุน ุงูุณุฌูุงุช ูู:
**Vercel Dashboard** โ **Your Project** โ **Deployments** โ **View Logs**

ุงุจุญุซ ุนู:
- `[Vercel] Database connected` โ
- `[getAllCourses] Found X courses` โ

## ๐ ุงุฎุชุจุงุฑ ุงูู API:

ุจุนุฏ ุงููุดุฑุ ุงุฎุชุจุฑ ุงูู endpoints:

```bash
# ุฌูุจ ุฌููุน ุงูุฏูุฑุงุช
curl https://courses-nine-eta.vercel.app/api/courses/

# ุงุฎุชุจุงุฑ ุงูุตุญุฉ
curl https://courses-nine-eta.vercel.app/api/health
```

## โก ูุตุงุฆุญ ููุฃุฏุงุก:

1. **ุงุณุชุฎุฏุงู Indexes ูู MongoDB**:
   - ุชุฃูุฏ ูู ูุฌูุฏ indexes ุนูู ุงูุญููู ุงููุณุชุฎุฏูุฉ ุจูุซุฑุฉ
   - ุฑุงุฌุน ุงูู indexes ูู ุงูููุงุฐุฌ

2. **ุชูููู ุญุฌู ุงูุงุณุชุฌุงุจุฉ**:
   - ุงุณุชุฎุฏุงู `.select()` ูุงุฎุชูุงุฑ ุญููู ูุญุฏุฏุฉ ููุท
   - ุงุณุชุฎุฏุงู `.lean()` ูุชุญููู Mongoose documents ุฅูู plain objects

3. **Cache ุงูุงุณุชุฌุงุจุงุช** (ุงุฎุชูุงุฑู):
   - ุงุณุชุฎุฏุงู Redis ุฃู Vercel Edge Cache ููุงุณุชุฌุงุจุงุช ุงููุชูุฑุฑุฉ

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก:

### ุฅุฐุง ุงุณุชูุฑ ุงูุฎุทุฃ:

1. **ุชุญูู ูู Logs ูู Vercel**
2. **ุชุญูู ูู MongoDB Atlas**:
   - Network Access
   - Database User Credentials
   - Cluster Status
3. **ุงุฎุชุจุฑ ุงูุงุชุตุงู ูุญููุงู** ุจุงุณุชุฎุฏุงู ููุณ connection string

## ๐ ุงููุชูุฌุฉ ุงููุชููุนุฉ:

ุจุนุฏ ุชุทุจูู ูุฐู ุงูุชุญุณููุงุช:
- โก ุงุณุชุฌุงุจุฉ ุฃุณุฑุน (< 2 ุซุงููุฉ)
- โ ูุง ูุฒูุฏ ูู ุฃุฎุทุงุก timeout
- ๐ ุงุชุตุงู ูุณุชูุฑ ุจูุงุนุฏุฉ ุงูุจูุงูุงุช
- ๐ ุฃุฏุงุก ูุญุณู ูู ุจูุฆุฉ serverless
